<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kumpulan Obat</title>
    <link rel="stylesheet" href="materialize.css">
    <link rel="stylesheet" href="materializetambahan.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <style>
        table#tabelKumpulanObat tbody tr, tabel#tabelKumpulanObat1 tbody tr {
            cursor: pointer;
        }
        tr.selected {
            background-color: #ffeaea;
            border-bottom: 2px solid #ff7474;
        }
    </style>
</head>
<body>
    <ul class="tabs">
        <li class="tab"><a href="#collapseKumpulanObat">Kumpulan Obat</a></li>
        <li class="tab"><a href="#collapseTotalHarga">Periksa Total Akhir</a></li>
    </ul>

<div id="collapseKumpulanObat">
    <div class="row container">
        <h5 class="light">Kumpulan Nama Obat</h5>
        <small>BASÂ© SS - Coba ketik di bawah ini untuk mencari, atau jika penasaran tentang obat: Pilih Nama Obat lalu klik Tanya Copilot</small>
            <input id="inputKetikTabelKumpulanObat" class="col s12" type="text" placeholder="ðŸ’Š Ketik untuk mencari...">
            <span class="col s6 right-align">atau</span>
            <button id="btnTanyaCopilot" class="btn -btn-small red lighten-4 black-text col s6" disabled onclick="tanyaCopilot()"><img class="brown-text" src="copilot.svg" style="height: 1em;"> Tanya Copilot</button>
    </div>
    <table class="table table-small" id="tabelKumpulanObat">
        <thead>
            <tr>
                <th>Nama Obat</th>
                <th>Satuan</th>
                <th>Harga</th>
            </tr>
        </thead>
        <tbody id="NamaObat"></tbody>
    </table>
    <div id="nohasil" class="card-panel text-center" style="display: none;">
        <span style="font-size: 70px;"><i class="bi bi-emoji-surprise"></i></span><br>
        <strong>Wihh, Obat tidak dikenal! Coba ketik lainnya.</strong>
    </div>
</div>

<div id="collapseTotalHarga">
    <div class="container">
        <small>BASÂ© SS - Coba pilih obat dalam tabel lalu masukan angka beli berapa, atau bisa ketik untuk mencari lalu pilih dan masukan angka</small><br><br>
        <a href="#ModalMenuButton" class="btn btn-small brown waves-effect waves-light modal-trigger">Pilih Obat Di Sini</a>
    </div>
    <div class="divider"></div>
    <!-- MODAL #tabelKumpulanObat1 -->
    <div id="ModalMenuButton" class="modal bottom-sheet modal-fixed-footer" style="background-color: #ffffff4f;backdrop-filter: blur(15px);">
        <div class="modal-content">
            <form id="obatForm" class="form-group container">
            <div class="input-group mb-2 border border-primary rounded">
                <input class="form-control form-control-sm" id="ketiknama" type="text" placeholder="ðŸ’Š Ketik di sini...">
                <input class="form-control form-control-sm" type="number" id="jumlahobat" placeholder="âž• Beli berapa..." min="1" required>
                <div class="input-group-append">
                    <button class="btn brown btn-small" type="submit">Tambah</button>
                </div>
            </div>
            <table id="tabelKumpulanObat1">
                <thead>
                    <tr>
                        <th>Nama Obat</th>
                        <th>Satuan</th>
                        <th>Harga</th>
                    </tr>
                </thead>
                <tbody id="NamaObat1">
                </tbody>
            </table>
            </form>
            <div id="nohasil1" class="card-panel center-text" style="display: none;">
                <span style="font-size: 70px;"><i class="bi bi-emoji-surprise"></i></span><br>
                <strong>Wihh, Obat tidak dikenal! Coba ketik lainnya.</strong>
            </div>
        </div>
        <div class="modal-footer">
        <p class="left">Â© 2023 BASÂ© SS All rights reserved.</p>
        <a class="btn btn-small modal-close waves-effect waves-light brown">Tutup</a>
        </div>
    </div>
    <h5 class="light brown-text"><i class="bi bi-bag-heart"></i> Obat yang Akan Dibeli</h5>
    <table class="table table-small" id="tabelObatAkanDiBeli">
        <thead>
            <tr>
                <th>Nama Obat</th>
                <th>Harga</th>
                <th>Jumlah</th>
                <th>Total</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
    </table>
    <h4 class="brown-text"><i class="bi bi-cash-coin"></i> Total Akhir: Rp <span id="totalSemuaObat">0</span></h4>
    <i><i class="bi bi-info-circle"></i> Total di atas hanya perkiraaan</i>
    <button class="btn btn-small brown waves-effect waves-light" id="reset"><i class="bi bi-arrow-counterclockwise"></i> Atur ulang semua</button>
</div><!-- Akhir tab content #collapseTotalHarga -->

<!-- Tombol Scroll to Top -->
<i id="scrollTopBtn" class="bi bi-arrow-up-circle-fill" title="Kembali ke Atas" style="transition: 0.3s;display:none;position:fixed;bottom:30px;right:30px;z-index:1054;font-size: xx-large;color:#ff7474;"></i>

<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script src="materialize.js"></script>
<!-- Inisialisasi Materialize CSS -->
<script>
    $(document).ready(function(){
        $('.tabs').tabs();
        $('.modal').modal();
    });
</script>
    
<script>
// Tombol Scroll to Top ke atas
const scrollBtn = document.getElementById('scrollTopBtn');
window.addEventListener('scroll', function() {
  if (window.scrollY > 200) {
    scrollBtn.style.display = 'block';
  } else {
    scrollBtn.style.display = 'none';
  }
});
scrollBtn.addEventListener('click', function() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
});
</script>
    
<!-- AREA CONVERT CSV 3 KOLOM KE TABEL #tabelKumpulanObat & #tabelKumpulanObat1-->
<script>
    // Fungsi untuk membaca dan memparsing file CSV
  let dataObat = {};

  function readCSVFile(file, callback) {
    const xhr = new XMLHttpRequest();
    xhr.open('GET', file, true);
    xhr.onload = function() {
      if (xhr.status === 200) {
        const rows = xhr.responseText.split('\n');
        const data = rows.map(row => row.split(';'));
        callback(data);
      }
    };
    xhr.send();
  }

  // untuk membuat tabel #tabelKumpulanObat
  function createTable(data) {
    const tbody = document.getElementById('NamaObat');
    data.forEach((row, index) => {
      if (index > 0 && row.length >= 3) {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${row[0]}</td>
          <td>${row[1]}</td>
          <td>${row[2]}</td>
        `;
        tr.onclick = () => {
          document.querySelectorAll("#tabelKumpulanObat tr").forEach(tr => tr.classList.remove("selected"));
          tr.classList.add("selected");
          dataObat = { nama: row[0], satuan: row[1], harga: row[2] };
          document.getElementById("btnTanyaCopilot").disabled = false;
        };
        tbody.appendChild(tr);
      }
    });
  }

    // Fungsi untuk membuat tabel #tabelKumpulanObat1
    function createTable1(data) {
        const tbody = document.getElementById('NamaObat1');
        data.forEach((row, index) => {
            if (index > 0) {  // Lewati baris header
                const tr = document.createElement('tr');
                row.forEach(cell => {
                    const td = document.createElement('td');
                    td.textContent = cell;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            }
        });
    }

    // Fungsi untuk menanyakan ke Copilot
  function tanyaCopilot() {
    const query = `Jelaskan tentang ${dataObat.nama}, satuan ${dataObat.satuan}`;
    window.open(`https://copilot.microsoft.com/?q=${encodeURIComponent(query)}`);
  }

  // Membaca dan memparsing file CSV, lalu membuat tabel
    readCSVFile('KumpulanObat.csv', function(data) {
        createTable(data);
        createTable1(data);
    });
</script>
<!-- AREA Tabel Kumpulan Obat -->
<script>
// FILTER KETIK TABEL KumpulanObat & MUNCUL KALIMAT TIDAK ADA
    $(document).ready(function(){
        $("#inputKetikTabelKumpulanObat").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            var found = false;
            $("#NamaObat tr").filter(function() {
                var match = $(this).text().toLowerCase().indexOf(value) > -1;
                $(this).toggle(match);
                if (match) found = true;
            });
            if (found) {
                $("#nohasil").hide();
            } else {
                $("#nohasil").show();
            }
        });
    });
</script>
<!-- AREA DROPDOWN & OBAT AKAN DIBELI -->
<script>
    // FILTER KETIK TABEL di DROPDOWN & MUNCUL KALIMAT TIDAK ADA
    $(document).ready(function(){
        $("#ketiknama").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            var found = false;
            $("#NamaObat1 tr").filter(function() {
                var match = $(this).text().toLowerCase().indexOf(value) > -1;
                $(this).toggle(match);
                if (match) found = true;
            });
            if (found) {
                $("#nohasil1").hide();
            } else {
                $("#nohasil1").show();
            }
        });
    });
</script>
<script>
    // Fungsi untuk memformat angka menjadi format harga (dengan titik)
    function formatHarga(angka) {
        return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    $(document).ready(function () {
        // Klik baris tabel #tabelKumpulanObat1
        $("#tabelKumpulanObat1").on("click", "tr", function () {
            const namaObat = $(this).find("td:nth-child(1)").text();
            const hargaObat = $(this).find("td:nth-child(3)").text().replace(/\./g, ""); // Hapus titik untuk konversi ke angka

            // Isi input #ketiknama dan fokus ke #jumlahobat
            $("#ketiknama").val(namaObat);
            $("#jumlahobat").focus();

            // Simpan harga obat di atribut data untuk digunakan saat tombol "Tambah" diklik
            $("#jumlahobat").data("hargaObat", hargaObat);
        });

        // Klik tombol "Tambah"
        $("#obatForm").on("submit", function (e) {
            e.preventDefault();

            const namaObat = $("#ketiknama").val();
            const jumlahObat = parseInt($("#jumlahobat").val());
            const hargaObat = $("#jumlahobat").data("hargaObat");

            if (!namaObat || !jumlahObat || isNaN(hargaObat)) {
                alert("Data tidak valid!");
                return;
            }

            const totalHarga = hargaObat * jumlahObat;

            // Tambahkan ke tabel #tabelObatAkanDiBeli
            const row = `
                <tr>
                    <td>${namaObat}</td>
                    <td>Rp ${formatHarga(hargaObat)}</td>
                    <td>${jumlahObat}</td>
                    <td>Rp ${formatHarga(totalHarga)}</td>
                </tr>
            `;
            $("#tabelObatAkanDiBeli tbody").append(row);

            // Update total semua obat
            const totalSemuaObat = Array.from($("#tabelObatAkanDiBeli tbody tr"))
                .map((tr) => parseInt($(tr).find("td:nth-child(4)").text().replace(/\./g, "").replace("Rp ", "")))
                .reduce((a, b) => a + b, 0);

            $("#totalSemuaObat").text(formatHarga(totalSemuaObat));

            // Reset input
            $("#ketiknama").val("");
            $("#jumlahobat").val("").removeData("hargaObat");
        });

        // Klik tombol "Reset"
        $("#reset").on("click", function () {
            // Hapus semua baris di tabel #tabelObatAkanDiBeli
            $("#tabelObatAkanDiBeli tbody").empty();

            // Atur ulang total harga menjadi 0
            $("#totalSemuaObat").text("0");
        });
    });
</script>
</body>
</html>